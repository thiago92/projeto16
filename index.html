<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>App Pesquisa Endereço</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">  

	<script>

		function getDadosPais(paises) {
		const paisSelecionado = document.querySelector("#paises option:checked").text;
		document.getElementById("pais").value = paisSelecionado;
		//console.log(paisSelecionado);

		let url = 'https://dev.kidopilabs.com.br/exercicio/covid.php?pais='+paisSelecionado

		let xmlHttp = new XMLHttpRequest()
		xmlHttp.open('GET', url)

		xmlHttp.onreadystatechange = () => {
			if(xmlHttp.readyState == 4 && xmlHttp.status == 200) {
				let dadosJSONText = xmlHttp.responseText
				let dadosJSONObj = JSON.parse(dadosJSONText)

				document.getElementById('pais').value = dadosJSONObj[0].Pais
				document.getElementById('estado').value = dadosJSONObj[0].ProvinciaEstado
				document.getElementById('confirmados').value = dadosJSONObj[0].Confirmados
				document.getElementById('mortos').value = dadosJSONObj[0].Mortos

			}
		}

		xmlHttp.send()
		}

	</script>
</head>
<body>
    
    <nav class="navbar navbar-light bg-light mb-4">
        <div class="container">
            <div class="navbar-brand mb-0 h1">
                <h3>App Pesquisa Países / Covid19</h3>
            </div>
        </div>
    </nav>

    <div class="container">
		<div class="row form-group">
			<div class="col-sm-6">
				<label for="paises">Selecione um país:</label>
				<select id="paises" onblur="getDadosPais(this.value)"></select>
			</div>
		</div>
		<div class="row form-group">

			<div class="col-sm-3">
				<label for="pais">País selecionado:</label>
				<input type="text" class="form-control" placeholder="País" readonly id="pais"/>
			</div>

			<div class="col-sm-3">
				<label for="estado">Estado/Província:</label>
				<input type="text" class="form-control" placeholder="Provincia/Estado" readonly id="estado"/>
			</div>

			<div class="col-sm-3">
				<label for="confirmados">Casos confirmados:</label>
				<input type="text" class="form-control" placeholder="Confirmados" readonly id="confirmados"/>
			</div>

			<div class="col-sm-3">
				<label for="mortos">Mortos:</label>
				<input type="text" class="form-control" placeholder="Mortos" readonly id="mortos"/>
			</div>
		</div>
    </div>

    <script>
        window.addEventListener("load", () => {
            const select = document.getElementById("paises");

            fetch("https://dev.kidopilabs.com.br/exercicio/covid.php?listar_paises=1")
                .then(response => response.json())
                .then(data => {
                    for (const [key, value] of Object.entries(data)) {
                        const option = document.createElement("option");
                        option.value = key;
                        option.text = value;
                        select.appendChild(option);
                    }
                })
                .catch(error => console.error(error));
        });
    </script>
</body>
</html>
